generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

generator erd {
  provider                  = "prisma-erd-generator"
  output                    = "../docs/ERD.png"
  includeRelationFromFields = "true"
  theme                     = "forest"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Type {
  id                    Int                 @id @default(autoincrement())
  name                  String              @unique
  nameEn                String              @unique @map("name_en")
  createdAt             DateTime            @default(now()) @map("created_at")
  updatedAt             DateTime            @updatedAt @map("updated_at")
  moves                 Move[]
  pokemonPrimaryTypes   Pokemon[]           @relation("PrimaryType")
  pokemonSecondaryTypes Pokemon[]           @relation("SecondaryType")
  typeEffectivenessFrom TypeEffectiveness[] @relation("TypeFrom")
  typeEffectivenessTo   TypeEffectiveness[] @relation("TypeTo")

  @@map("types")
}

model Pokemon {
  id                 Int              @id @default(autoincrement())
  nationalDex        Int              @unique @map("national_dex")
  name               String           @unique
  nameEn             String           @unique @map("name_en")
  primaryTypeId      Int              @map("primary_type_id")
  secondaryTypeId    Int?             @map("secondary_type_id")
  baseHp             Int              @map("base_hp")
  baseAttack         Int              @map("base_attack")
  baseDefense        Int              @map("base_defense")
  baseSpecialAttack  Int              @map("base_special_attack")
  baseSpecialDefense Int              @map("base_special_defense")
  baseSpeed          Int              @map("base_speed")
  createdAt          DateTime         @default(now()) @map("created_at")
  updatedAt          DateTime         @updatedAt @map("updated_at")
  pokemonAbilities   PokemonAbility[]
  pokemonMoves       PokemonMove[]
  primaryType        Type             @relation("PrimaryType", fields: [primaryTypeId], references: [id])
  secondaryType      Type?            @relation("SecondaryType", fields: [secondaryTypeId], references: [id])
  trainedPokemon     TrainedPokemon[]

  @@map("pokemons")
}

model Ability {
  id               Int              @id @default(autoincrement())
  name             String           @unique
  nameEn           String           @unique @map("name_en")
  description      String
  triggerEvent     AbilityTrigger   @map("trigger_event")
  effectCategory   AbilityCategory  @map("effect_category")
  createdAt        DateTime         @default(now()) @map("created_at")
  updatedAt        DateTime         @updatedAt @map("updated_at")
  pokemonAbilities PokemonAbility[]
  trainedPokemon   TrainedPokemon[]

  @@map("abilities")
}

model Move {
  id                 Int                 @id @default(autoincrement())
  name               String              @unique
  nameEn             String              @unique @map("name_en")
  typeId             Int                 @map("type_id")
  category           MoveCategory
  power              Int?
  accuracy           Int?
  pp                 Int                 @default(1)
  priority           Int                 @default(0)
  description        String?
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  battlePokemonMoves BattlePokemonMove[]
  type               Type                @relation(fields: [typeId], references: [id])
  pokemonMoves       PokemonMove[]

  @@map("moves")
}

model TypeEffectiveness {
  id            Int      @id @default(autoincrement())
  typeFromId    Int      @map("type_from_id")
  typeToId      Int      @map("type_to_id")
  effectiveness Float
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  typeFrom      Type     @relation("TypeFrom", fields: [typeFromId], references: [id])
  typeTo        Type     @relation("TypeTo", fields: [typeToId], references: [id])

  @@unique([typeFromId, typeToId])
  @@map("type_effectiveness")
}

model PokemonAbility {
  id        Int      @id @default(autoincrement())
  pokemonId Int      @map("pokemon_id")
  abilityId Int      @map("ability_id")
  isHidden  Boolean  @default(false) @map("is_hidden")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  ability   Ability  @relation(fields: [abilityId], references: [id], onDelete: Cascade)
  pokemon   Pokemon  @relation(fields: [pokemonId], references: [id], onDelete: Cascade)

  @@unique([pokemonId, abilityId])
  @@map("pokemon_abilities")
}

model PokemonMove {
  id        Int      @id @default(autoincrement())
  pokemonId Int      @map("pokemon_id")
  moveId    Int      @map("move_id")
  level     Int?
  method    String?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  move      Move     @relation(fields: [moveId], references: [id], onDelete: Cascade)
  pokemon   Pokemon  @relation(fields: [pokemonId], references: [id], onDelete: Cascade)

  @@map("pokemon_moves")
}

model Trainer {
  id                  Int                   @id @default(autoincrement())
  name                String                @unique
  email               String?               @unique
  createdAt           DateTime              @default(now()) @map("created_at")
  updatedAt           DateTime              @updatedAt @map("updated_at")
  battlePokemonStatus BattlePokemonStatus[] @relation("BattlePokemonStatus")
  battlesAsTrainer1   Battle[]              @relation("Trainer1Battles")
  battlesAsTrainer2   Battle[]              @relation("Trainer2Battles")
  battlesAsWinner     Battle[]              @relation("WinnerBattles")
  teams               Team[]
  trainedPokemon      TrainedPokemon[]

  @@map("trainers")
}

model TrainedPokemon {
  id                  Int                   @id @default(autoincrement())
  trainerId           Int                   @map("trainer_id")
  pokemonId           Int                   @map("pokemon_id")
  nickname            String?
  level               Int                   @default(50)
  gender              Gender?
  nature              Nature?
  abilityId           Int?                  @map("ability_id")
  ivHp                Int                   @default(31) @map("iv_hp")
  ivAttack            Int                   @default(31) @map("iv_attack")
  ivDefense           Int                   @default(31) @map("iv_defense")
  ivSpecialAttack     Int                   @default(31) @map("iv_special_attack")
  ivSpecialDefense    Int                   @default(31) @map("iv_special_defense")
  ivSpeed             Int                   @default(31) @map("iv_speed")
  evHp                Int                   @default(0) @map("ev_hp")
  evAttack            Int                   @default(0) @map("ev_attack")
  evDefense           Int                   @default(0) @map("ev_defense")
  evSpecialAttack     Int                   @default(0) @map("ev_special_attack")
  evSpecialDefense    Int                   @default(0) @map("ev_special_defense")
  evSpeed             Int                   @default(0) @map("ev_speed")
  createdAt           DateTime              @default(now()) @map("created_at")
  updatedAt           DateTime              @updatedAt @map("updated_at")
  battlePokemonStatus BattlePokemonStatus[]
  teamMembers         TeamMember[]
  ability             Ability?              @relation(fields: [abilityId], references: [id])
  pokemon             Pokemon               @relation(fields: [pokemonId], references: [id], onDelete: Cascade)
  trainer             Trainer               @relation(fields: [trainerId], references: [id], onDelete: Cascade)

  @@map("trained_pokemon")
}

model TeamMember {
  id               Int            @id @default(autoincrement())
  teamId           Int            @map("team_id")
  trainedPokemonId Int            @map("trained_pokemon_id")
  position         Int
  createdAt        DateTime       @default(now()) @map("created_at")
  updatedAt        DateTime       @updatedAt @map("updated_at")
  team             Team           @relation(fields: [teamId], references: [id], onDelete: Cascade)
  trainedPokemon   TrainedPokemon @relation(fields: [trainedPokemonId], references: [id], onDelete: Cascade)

  @@unique([teamId, position])
  @@map("team_members")
}

model Team {
  id             Int          @id @default(autoincrement())
  trainerId      Int          @map("trainer_id")
  name           String
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @updatedAt @map("updated_at")
  battlesAsTeam1 Battle[]     @relation("Team1Battles")
  battlesAsTeam2 Battle[]     @relation("Team2Battles")
  teamMembers    TeamMember[]
  trainer        Trainer      @relation(fields: [trainerId], references: [id], onDelete: Cascade)

  @@map("teams")
}

model Battle {
  id                  Int                   @id @default(autoincrement())
  trainer1Id          Int                   @map("trainer1_id")
  trainer2Id          Int                   @map("trainer2_id")
  team1Id             Int                   @map("team1_id")
  team2Id             Int                   @map("team2_id")
  turn                Int                   @default(1)
  weather             Weather?
  field               Field?
  status              BattleStatus          @default(Active)
  winnerTrainerId     Int?                  @map("winner_trainer_id")
  createdAt           DateTime              @default(now()) @map("created_at")
  updatedAt           DateTime              @updatedAt @map("updated_at")
  battlePokemonStatus BattlePokemonStatus[]
  team1               Team                  @relation("Team1Battles", fields: [team1Id], references: [id], onDelete: Cascade)
  team2               Team                  @relation("Team2Battles", fields: [team2Id], references: [id], onDelete: Cascade)
  trainer1            Trainer               @relation("Trainer1Battles", fields: [trainer1Id], references: [id], onDelete: Cascade)
  trainer2            Trainer               @relation("Trainer2Battles", fields: [trainer2Id], references: [id], onDelete: Cascade)
  winnerTrainer       Trainer?              @relation("WinnerBattles", fields: [winnerTrainerId], references: [id])

  @@map("battles")
}

model BattlePokemonStatus {
  id                 Int                 @id @default(autoincrement())
  battleId           Int                 @map("battle_id")
  trainedPokemonId   Int                 @map("trained_pokemon_id")
  trainerId          Int                 @map("trainer_id")
  isActive           Boolean             @default(false) @map("is_active")
  currentHp          Int                 @map("current_hp")
  maxHp              Int                 @map("max_hp")
  attackRank         Int                 @default(0) @map("attack_rank")
  defenseRank        Int                 @default(0) @map("defense_rank")
  specialAttackRank  Int                 @default(0) @map("special_attack_rank")
  specialDefenseRank Int                 @default(0) @map("special_defense_rank")
  speedRank          Int                 @default(0) @map("speed_rank")
  accuracyRank       Int                 @default(0) @map("accuracy_rank")
  evasionRank        Int                 @default(0) @map("evasion_rank")
  statusCondition    StatusCondition?    @map("status_condition")
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  battlePokemonMoves BattlePokemonMove[]
  battle             Battle              @relation(fields: [battleId], references: [id], onDelete: Cascade)
  trainedPokemon     TrainedPokemon      @relation(fields: [trainedPokemonId], references: [id], onDelete: Cascade)
  trainer            Trainer             @relation("BattlePokemonStatus", fields: [trainerId], references: [id], onDelete: Cascade)

  @@unique([battleId, trainedPokemonId])
  @@map("battle_pokemon_status")
}

model BattlePokemonMove {
  id                    Int                 @id @default(autoincrement())
  battlePokemonStatusId Int                 @map("battle_pokemon_status_id")
  moveId                Int                 @map("move_id")
  currentPp             Int                 @map("current_pp")
  maxPp                 Int                 @map("max_pp")
  createdAt             DateTime            @default(now()) @map("created_at")
  updatedAt             DateTime            @updatedAt @map("updated_at")
  battlePokemonStatus   BattlePokemonStatus @relation(fields: [battlePokemonStatusId], references: [id], onDelete: Cascade)
  move                  Move                @relation(fields: [moveId], references: [id], onDelete: Cascade)

  @@unique([battlePokemonStatusId, moveId])
  @@map("battle_pokemon_moves")
}

enum AbilityTrigger {
  OnEntry
  OnTakingDamage
  OnDealingDamage
  OnTurnEnd
  OnSwitchOut
  Passive
  OnStatusCondition
  Other
}

enum AbilityCategory {
  StatChange
  Immunity
  Weather
  DamageModify
  StatusCondition
  Other
}

enum MoveCategory {
  Physical
  Special
  Status
}

enum Gender {
  Male
  Female
  Genderless
}

enum Nature {
  Hardy
  Lonely
  Brave
  Adamant
  Naughty
  Bold
  Docile
  Relaxed
  Impish
  Lax
  Timid
  Hasty
  Serious
  Jolly
  Naive
  Modest
  Mild
  Quiet
  Bashful
  Rash
  Calm
  Gentle
  Sassy
  Careful
  Quirky
}

enum Weather {
  None
  Sun
  Rain
  Sandstorm
  Hail
}

enum Field {
  None
  ElectricTerrain
  GrassyTerrain
  PsychicTerrain
  MistyTerrain
}

enum BattleStatus {
  Active
  Completed
  Abandoned
}

enum StatusCondition {
  None
  Burn
  Freeze
  Paralysis
  Poison
  BadPoison
  Sleep
}
